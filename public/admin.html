<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>FB Bot Admin</title>
  <style>
    body{font-family: Arial; padding:20px;}
    table{border-collapse:collapse;width:100%}
    th,td{border:1px solid #ddd;padding:8px}
  </style>
</head>
<body>
  <h2>FB Bot Admin</h2>
  <div>
    <button onclick="loadLocks()">Load Locks</button>
    <button onclick="loadAlerts()">Load Alerts</button>
  </div>
  <h3>Locks</h3>
  <table id="locks"><thead><tr><th>PSID</th><th>Nick</th><th>Last Name</th><th>Locked</th><th>Action</th></tr></thead><tbody></tbody></table>
  <h3>Alerts</h3>
  <table id="alerts"><thead><tr><th>Time</th><th>PSID</th><th>Old</th><th>New</th></tr></thead><tbody></tbody></table>

  <script>
    async function loadLocks(){
      const res = await fetch('/admin/locks');
      const data = await res.json();
      const tbody = document.querySelector('#locks tbody');
      tbody.innerHTML = '';
      data.forEach(r=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.psid}</td><td>${r.nickname||''}</td><td>${r.last_known_name||''}</td><td>${r.name_locked}</td>
          <td><button onclick="toggle('${r.psid}', ${r.name_locked?0:1})">${r.name_locked? 'Unlock':'Lock'}</button></td>`;
        tbody.appendChild(tr);
      });
    }
    async function loadAlerts(){
      const res = await fetch('/admin/alerts');
      const data = await res.json();
      const tbody = document.querySelector('#alerts tbody');
      tbody.innerHTML = '';
      data.forEach(a=>{
        const d = new Date(a.created_at*1000);
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${d.toLocaleString()}</td><td>${a.psid}</td><td>${a.old_name}</td><td>${a.new_name}</td>`;
        tbody.appendChild(tr);
      });
    }
    async function toggle(psid, lock){
      await fetch('/admin/toggle-lock', {method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({psid,lock})});
      loadLocks();
    }
  </script>
</body>
</html>
